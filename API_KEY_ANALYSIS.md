# Аналіз API ключа та даних SDK

## Перевірений ключ
```
bf23ab763305a8ca3c665d5d9806740d6eefdfe8f968e079024b60700300d12f
```

## Результат перевірки
❌ **Ключ НЕ ЗНАЙДЕНО в базі даних**

Цей API ключ не існує в системі TMA Tracker SDK.

### Можливі причини:
1. **Ключ ніколи не був створений** - це випадковий рядок
2. **Ключ був видалений** - деактивований через Admin API
3. **Ключ з іншої бази даних** - якщо є кілька інстансів SDK

### Як перевірити:
Ключ має формат 64 hex символів (256 біт), що відповідає формату генерації через `crypto.randomBytes(32).toString('hex')`, але це не означає, що він був згенерований саме цією системою.

---

## Існуючі ключі в системі

### 1. Client API Key
```
073dc2bd3f34f2ecda8d76c7f1a354243e9f601e5c951203555f5fb08ae89f5a
```
- **Тип**: `client`
- **Призначення**: Для відправки трекінгових подій з Mini App
- **Доступ**: Тільки запис даних (не може читати аналітику)

### 2. Agency API Key
```
4fec482b12cff09e66480cb12dbf1caeb78713f84622f5764c68fc0e775d9c16
```
- **Тип**: `agency`
- **Призначення**: Для отримання аналітики рекламних кампаній
- **Доступ**: Тільки читання аналітики (не може відправляти події)

---

## Які дані збирає SDK

### 1. При відкритті додатку (app_open)
SDK автоматично збирає при ініціалізації:
- ✅ **UTM параметр** (з `startapp` параметра URL)
- ✅ **Telegram User ID** (унікальний ідентифікатор користувача)
- ✅ **Username** (якщо доступний)
- ✅ **Language Code** (мова інтерфейсу користувача)
- ✅ **Timestamp** (час відкриття)

**Приклад даних:**
```json
{
  "utmParameter": "Campaign_1",
  "telegramUserId": 123456789,
  "username": "john_doe",
  "languageCode": "en",
  "timestamp": "2026-01-08T16:00:00.000Z"
}
```

### 2. При платежі (payment)
SDK збирає при виклику `trackPayment()`:
- ✅ **UTM параметр** (автоматично з сесії)
- ✅ **Telegram User ID**
- ✅ **Amount** (сума в Telegram Stars)
- ✅ **Payment ID** (опціонально, ID транзакції)
- ✅ **Timestamp** (час платежу)

**Приклад даних:**
```json
{
  "utmParameter": "Campaign_1",
  "telegramUserId": 123456789,
  "amount": 100,
  "paymentId": "inv_abc123",
  "timestamp": "2026-01-08T16:05:00.000Z"
}
```

---

## Що НЕ збирає SDK

❌ **Персональні дані:**
- Ім'я та прізвище
- Номер телефону
- Email
- Фото профілю

❌ **Поведінкові дані:**
- Історія переглядів
- Кліки та взаємодії
- Час проведений в додатку
- Геолокація

❌ **Фінансові дані:**
- Номери карток
- Банківські реквізити
- Історія транзакцій поза Telegram Stars

---

## Доступ до даних через API

### Client Key (073dc2bd...)
**Може відправляти:**
- POST `/api/v1/events` - відправка app_open та payment подій

**НЕ може:**
- Читати аналітику
- Отримувати дані інших користувачів
- Змінювати налаштування

### Agency Key (4fec482b...)
**Може отримувати:**
- POST `/api/v1/analytics` - аналітика по UTM параметрах:
  - Кількість унікальних користувачів
  - Кількість платників
  - Загальний дохід в Stars
  - Conversion rate

**Приклад відповіді:**
```json
{
  "data": [
    {
      "utm_parameter": "Campaign_1",
      "unique_users": 1523,
      "paying_users": 87,
      "total_revenue_stars": 12400,
      "conversion_rate": 5.71
    }
  ]
}
```

**НЕ може:**
- Отримати персональні дані користувачів
- Отримати Telegram User ID конкретних користувачів
- Отримати username користувачів
- Відправляти події

---

## Безпека

1. **Ізоляція даних**: Agency ключ не має доступу до персональних даних користувачів
2. **Обмеження доступу**: Кожен тип ключа має свої обмеження
3. **Rate Limiting**: 100 запитів на хвилину
4. **HTTPS only**: Всі дані передаються через захищене з'єднання

---

## Admin API - Генерація нових ключів

SDK має Admin API для генерації нових ключів для клієнтів.

### Як працює Admin API:

**1. Налаштування ADMIN_SECRET**
```env
ADMIN_SECRET=ed713a9e168f12583f3760c3a1dd190cf9e54cd2f334c4cd65a62e0d8f1eb792
```

**2. Генерація нового Client ключа**
```bash
curl -X POST http://localhost:3000/api/v1/admin/keys/generate \
  -H "x-admin-secret: ed713a9e168f12583f3760c3a1dd190cf9e54cd2f334c4cd65a62e0d8f1eb792" \
  -H "Content-Type: application/json" \
  -d '{"type": "client", "name": "Client Name - Bot Name"}'
```

**Відповідь:**
```json
{
  "success": true,
  "data": {
    "id": 3,
    "key": "a07a5db43bbcbd33f72b8a815e54c02671b6fc83a4f2664b5554867ebb31879d",
    "type": "client",
    "name": "Test Client - Demo Bot",
    "active": true,
    "createdAt": "2026-01-08T22:52:02.793Z"
  }
}
```

**3. Список всіх ключів**
```bash
curl http://localhost:3000/api/v1/admin/keys/list \
  -H "x-admin-secret: ed713a9e168f12583f3760c3a1dd190cf9e54cd2f334c4cd65a62e0d8f1eb792"
```

**4. Деактивація ключа**
```bash
curl -X DELETE http://localhost:3000/api/v1/admin/keys/delete \
  -H "x-admin-secret: ed713a9e168f12583f3760c3a1dd190cf9e54cd2f334c4cd65a62e0d8f1eb792" \
  -H "Content-Type: application/json" \
  -d '{"key": "ключ_для_видалення"}'
```

### Формат ключів:
- Всі ключі генеруються через `crypto.randomBytes(32).toString('hex')`
- Довжина: 64 hex символи (256 біт)
- Приклад: `a07a5db43bbcbd33f72b8a815e54c02671b6fc83a4f2664b5554867ebb31879d`

---

## Висновок

Ключ `bf23ab763305a8ca3c665d5d9806740d6eefdfe8f968e079024b60700300d12f` **не існує** в поточній базі даних і не може отримати жодних даних.

### Можливі сценарії:
1. **Ключ ніколи не створювався** - це випадковий рядок правильного формату
2. **Ключ був деактивований** - видалений через Admin API
3. **Ключ з іншого інстансу** - якщо є кілька серверів SDK

### Для роботи з SDK:
- **Використовуйте існуючі ключі** з бази даних
- **Або згенеруйте нові** через Admin API
- **Client Key** - для інтеграції в Mini App (відправка подій)
- **Agency Key** - для отримання аналітики (читання статистики)

